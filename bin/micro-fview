#!/usr/bin/env python

from microfview import Microfview, get_capture_object, parse_config_file
from microfview.plugins.display import DisplayPlugin

if __name__ == "__main__":
    import time
    import logging
    import argparse

    logging.basicConfig(level=logging.INFO)

    parser = argparse.ArgumentParser()
    parser.add_argument('capture', default='', nargs='?', type=str,
                        help='path to a video file or capture hardware device')
    parser.add_argument('--config', type=str,
                        help='path to a configuration file')
    args = parser.parse_args()

    conf = parse_config_file(args.config)

    cam = get_capture_object(args.capture, **conf['capture'])
    fview = Microfview(cam)
    fview.attach_plugin(DisplayPlugin('micro-fview'))

    try:
        fview.start()
        while not fview.finished:
           time.sleep(0.1)
    except KeyboardInterrupt:
        pass
    finally:
        fview.stop()
